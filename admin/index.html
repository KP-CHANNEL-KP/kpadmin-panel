<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KP VIP Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; padding:10px; }
    h1 { text-align:center; color:#00e7ff; }
    .card { background:#222; border-radius:10px; padding:15px; margin:15px 0; }
    label { display:block; margin-top:10px; }
    input { width:100%; padding:8px; border-radius:6px; border:none; margin-top:3px; }
    button { margin-top:10px; padding:10px; width:100%; border:none; border-radius:6px; background:#00a0ff; color:white; font-size:15px; font-weight:bold; cursor:pointer; }
    button:hover { background:#0077dd; }
    .row { display:flex; gap:15px; flex-wrap:wrap; }
    .row > .card { flex:1; min-width:260px; }
    .log-box { background:#000; color:#0ff; font-size:12px; padding:10px; height:200px; overflow-y:auto; white-space:pre-wrap; border-radius:6px; }
    #panel { display:none; }
    table { width:100%; border-collapse:collapse; font-size:14px; color:#ddd; margin-top:10px; }
    th,td { border:1px solid #333; padding:6px; }
    th { background:#333; }
  </style>
</head>
<body>

<h1>KP VIP Admin Panel</h1>

<div class="card" id="loginBox">
  <h2>ğŸ” Admin Login</h2>
  <label>Admin Secret:
    <input id="adminSecret" type="password" placeholder="Enter Secret">
  </label>
  <button onclick="login()">Login</button>
  <p id="loginMsg"></p>
</div>

<div id="panel">
  <div class="row">
    <div class="card">
      <h2>â• Create User</h2>
      <label>Username <input id="c_user"></label>
      <label>Password <input id="c_pass"></label>
      <label>Days <input id="c_days" type="number" value="30"></label>
      <button onclick="createUser()">Create</button>
    </div>

    <div class="card">
      <h2>â™»ï¸ Renew / Update</h2>
      <label>Username <input id="e_user"></label>
      <label>Extra Days <input id="e_days" type="number" value="30"></label>
      <button onclick="renewUser()">Renew</button>

      <h2>ğŸ—‘ Delete User</h2>
      <label>Username <input id="d_user"></label>
      <button onclick="delUser()">Delete</button>
    </div>
  </div>

  <div class="card">
    <h2>ğŸ” Check User</h2>
    <label>Username <input id="q_user"></label>
    <button onclick="checkUser()">Check</button>
    <pre id="checkInfo"></pre>
  </div>

  <div class="card">
    <h2>ğŸ“„ User List</h2>
    <button onclick="loadUsers()">Load</button>
    <div id="userList"></div>
  </div>

  <div class="card">
    <h2>ğŸ“Œ System Log</h2>
    <div id="log" class="log-box"></div>
  </div>
</div>

<script>
const API_BASE = "https://vpnadmin.kpwork.qzz.io/kpvip";

function log(msg){
  let box = document.getElementById("log");
  box.textContent += msg + "\n";
  box.scrollTop = box.scrollHeight;
}

function saveSecret(sec){ localStorage.setItem("ADMIN_SECRET", sec); }
function getSecret(){ return localStorage.getItem("ADMIN_SECRET") || ""; }
function showPanel(){ document.getElementById("panel").style.display="block"; document.getElementById("loginBox").style.display="none"; }

function login(){
  const sec = document.getElementById("adminSecret").value.trim();
  if(!sec) return alert("Enter Secret!");
  saveSecret(sec);
  document.getElementById("loginMsg").innerText="âœ” Logged in locally";
  showPanel();
  log("Login OK");
}

async function post(path, body={}){
  const sec = getSecret();
  if(!sec) return alert("No secret!");

  let res = await fetch(API_BASE+path, {
    method:"POST",
    headers:{
      "Content-Type":"application/x-www-form-urlencoded",
      "x-admin-secret": sec
    },
    body:new URLSearchParams(body)
  });

  let data;
  try{ data = await res.json(); }catch{ data = {status:"error", raw: await res.text()}; }
  log(path+" => "+JSON.stringify(data));
  return data;
}

async function createUser(){
  let d = await post("/create.php",{
    username: c_user.value.trim(),
    password: c_pass.value.trim(),
    days: c_days.value.trim()
  });
  alert(d.status === "ok" ? "Created!" : d.message);
}

async function renewUser(){
  let d = await post("/edit.php",{ username: e_user.value.trim(), days: e_days.value.trim() });
  alert(d.status==="ok" ? "Updated!" : d.message);
}

async function delUser(){
  let u = d_user.value.trim();
  if(!u) return alert("Enter user!");
  let d = await post("/delete.php",{ username:u });
  alert(d.status==="ok" ? "Deleted!" : d.message);
}

async function checkUser(){
  let u = q_user.value.trim();
  if(!u) return alert("Enter user!");
  let d = await post("/user_exist.php",{ username:u });
  checkInfo.textContent = JSON.stringify(d,null,2);
}

async function loadUsers(){
  let d = await post("/list.php");
  if(d.status!=="ok") return alert("Fail!");
  
  let html = "<table><tr><th>User</th><th>Expire</th></tr>";
  d.users.forEach(u=>{
    html+=`<tr><td>${u.username}</td><td>${u.expireAt?new Date(u.expireAt*1000).toLocaleString():"-"}</td></tr>`;
  });
  html+="</table>";
  userList.innerHTML = html;
}

window.onload = ()=>{
  if(getSecret()){ showPanel(); log("Auto Login âœ“"); }
};
</script>

</body>
</html>
